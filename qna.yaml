document_outline: Information for using IBM Cloud Logs Routing to collect and route IBM Cloud logs from your account to a configured target.
domain: IBM Cloud Logs Routing
seed_examples:
  - context: |
      ## Creating a tenant
      {: #getting-started-create-tenant}
      {: step}
      
      When the {{site.data.keyword.logs_routing_full_notm}} console is first displayed, any existing target information is displayed.
      
      If no target is configured for a region, the region displays the **Set target** option.
      
      From the {{site.data.keyword.logs_routing_full_notm}} console, you can create a tenant and a target destination by configuring the option **Set target** for the region that you want to configure.
      
      Complete the following steps:
      1. [Log in to your {{site.data.keyword.cloud_notm}} account](https://cloud.ibm.com/login){: external}.
      2. Click the **Menu** icon ![Menu icon](../icons/icon_hamburger.svg "Menu") &gt; **Observability**.
      3. Click **Logging** > **Routing**.
      4. Click **Set target**.
      5. Click the tab **Cloud Logs** and select an {{site.data.keyword.logs_full_notm}} instance from the list. This is the instance where you want to receive logs that are routed by {{site.data.keyword.logs_routing_full_notm}}.
      
        You can select an {{site.data.keyword.logs_full_notm}} instance from the list.
      
        The {{site.data.keyword.logs_full_notm}} instance must be located in the same account that you are configuring.
        {: note}
      6. Click **Save**.
    questions_and_answers:
      - question: How do I create a tenant?
        answer: You can create a tenant and a target destination by configuring the option **Set target** for the region that you want to configure.
      - question: What are the steps to create a tenant?
        answer: | 
          1. Log into your account.
          2. Click the **Menu** icon ![Menu icon](../icons/icon_hamburger.svg "Menu") &gt; **Observability**.
          3. Click **Logging** > **Routing**.
          4. Click **Set target**.
          5. Click the tab **Cloud Logs** and select an {{site.data.keyword.logs_full_notm}} instance from the list. This is the instance where you want to receive logs that are routed by {{site.data.keyword.logs_routing_full_notm}}.

            You can select an {{site.data.keyword.logs_full_notm}} instance from the list.

            The {{site.data.keyword.logs_full_notm}} instance must be located in the same account that you are configuring.
            {: note}
          6. Click **Save**. 
      - question: Where can the {{site.data.keyword.logs_full_notm}} instances be?
        answer: The {{site.data.keyword.logs_full_notm}} instance must be located in the same account that you are configuring.
  - context: |
      5. Set up permissions to manage targets in the account. For more information, see [Granting IAM permissions](/docs/logs-router?topic=logs-router-iam-permissions&interface=ui).

      Before you can set up the {{site.data.keyword.logs_routing_full_notm}} service to route your platform logs, you need an {{site.data.keyword.iamlong}} (IAM) access token for authentication. The {{site.data.keyword.cloud_notm}} CLI is used to obtain this information.

        1. Log in to your {{site.data.keyword.cloud_notm}} account. Include the `--sso` option if you are using a federated ID.

          ```text
          ibmcloud login [--sso]
           ```
          {: pre}

          The output will include your username similar to:

          ```text
          Targeted account Jane Doe\'s Account (111111111112a21af53a2aeed19a1542a44) <-> 11111156


            API endpoint:     https://cloud.ibm.com
            Region:           us-south
            User:             Jane.Doe@ibm.com
            Account:          Jane Doe\'s Account (111111111112a21af53a2aeed19a1542a44) <-> 11111156
            Resource group:   No resource group targeted, use 'ibmcloud target -g RESOURCE_GROUP'
            ```
            {: screen}

        2. To grant access for using {{site.data.keyword.logs_routing_full_notm}} to your user, collect the username from the above generated output. In our example, this would be Jane.Doe@ibm.com. Replace `<username>` with your username in the following command:

            ```text
            ibmcloud iam user-policy-create <username> --roles Manager --service-name logs-router
            ```
            {: codeblock}

            Instead of assigning roles directly to identities, a common strategy is to assign roles to access groups, and add identities as members to those access groups. For more information about access groups, see [setting up access groups.](/docs/account?topic=account-groups&interface=cli)
            {: tip}
    questions_and_answers:
      - question: Why can't I route my platform logs?
        answer: Before you can route your platform logs, you must create an IAM access token.
      - question: How do I grant access for using IBM Logs Routing?
        answer: Run the command `ibmcloud iam user-policy-create <username> --roles Manager --service-name logs-router`
      - question: How do I obtain an IAM access token for authenticating with the Logs Routing service to manage log routing in my IBM Cloud account?
        answer: |
          To obtain an IAM access token for authenticating with the {{site.data.keyword.logs_routing_full_notm}} service, follow these steps:
          1. Log in to your IBM Cloud account using the `ibmcloud login` command. If you are using a federated ID, include the `--sso` option.
          2. After logging in, collect your username from the output, which resembles:
            ```
            Targeted account Jane Doe\'s Account (111111111112a21af53a2aeed19a1542a44) <-> 11111156


            API endpoint:     https://cloud.ibm.com
            Region:           us-south
            User:             Jane.Doe@ibm.com
            Account:          Jane Doe\'s Account (111111111112a21af53a2aeed19a1542a44) <-> 11111156
            Resource group:   No resource group targeted, use 'ibmcloud target -g RESOURCE_GROUP'
            ```
          3. To grant access for using {{site.data.keyword.logs_routing_full_notm}} to your user, replace <username> with your username in the following command:
            ```
            ibmcloud iam user-policy-create <username> --roles Manager --service-name logs-router
            ```
          It's also recommended to assign roles to access groups instead of directly to identities. For more information on setting up access groups, refer to the IBM Cloud documentation on account groups.
  - context: |
      # Are you having trouble connecting to {{site.data.keyword.logs_routing_full_notm}} using the VPE?
      {: #ts-vpe-gw-setup}
      {: troubleshoot}
      {: support}

      {{site.data.keyword.logs_routing_full_notm}} supports ingestion only via private endpoints.
      When using Gen2 infrastructure, the recommended way to connect is using a VPE gateway,
      although CSE proxy is also supported.
      When using classic infrastructure, VPE is not supported and only the CSE proxy can be used.
      {: shortdesc}

      When the VPE gateway is not set up correctly, this will result in network errors when trying to connect.
      {: tsSymptoms}

      VPE gateways are only available when using Gen2 infrastructure, and need to be created before connection will be possible.
      {: tsCauses}

      Check that you are using Gen2 infrastructure. If you are using classic infrastructure, the CSE proxy endpoints have to be used.
      Next, ensure that the VPE gateway between {{site.data.keyword.logs_routing_full_notm}} and your VPC has been correctly created.
      {: tsResolve}
    questions_and_answers:
      - question: What are the supported methods for connecting to Logs Routing?
        answer: IBM Cloud Logs Routing supports ingestion through private endpoints only. For Gen2 infrastructure, the recommended connection method is by using a VPE gateway, although the CSE proxy is also supported. For classic infrastructure, only the CSE proxy can be used, as VPE is not supported.
      - question: I can't connect to Logs Routing using the VPE.
        answer: | 
          You must use a VPE gateway when using Gen2 infrastructure. If the VPE gateway is not set up correctly it will result in network errors when trying to connect.
          In addition, the VPE gateway must be created before a connection is possible.
      - question: I can't connect to Logs Routing from classic infrastructure
        answer: You must use CSE proxy endpoints. 
  - context: |
      ## Locations where activity tracking events are generated
      {: #at-locations}

      {{site.data.keyword.logs_routing_full_notm}} sends activity tracking events by {{site.data.keyword.atracker_full_notm}} in the regions that are indicated in the following table.

      | Dallas (`us-south`) | Washington (`us-east`)  | Toronto (`ca-tor`) | Sao Paulo (`br-sao`) |
      |---------------------|-------------------------|-------------------|----------------------|
      | [Yes]{: tag-green} | [Yes]{: tag-green} | [Yes]{: tag-green} | [Yes]{: tag-green} |
      {: caption="Regions where activity tracking events are sent in Americas locations" caption-side="top"}
      {: #atracker-table-1}
      {: tab-title="Americas"}
      {: tab-group="atracker"}
      {: class="simple-tab-table"}
      {: row-headers}

      | Tokyo (`jp-tok`)    | Sydney (`au-syd`) |  Osaka (`jp-osa`) | Chennai (`in-che`) |
      |---------------------|------------------|------------------|--------------------|
      | [Yes]{: tag-green} | [Yes]{: tag-green} | [Yes]{: tag-green} | [No]{: tag-red} |
      {: caption="Regions where activity tracking events are sent in Asia Pacific locations" caption-side="top"}
      {: #atracker-table-2}
      {: tab-title="Asia Pacific"}
      {: tab-group="atracker"}
      {: class="simple-tab-table"}
      {: row-headers}

      | Frankfurt (`eu-de`)  | London (`eu-gb`) | Madrid (`eu-es`) |
      |---------------------------------------------------------------|---------------------|------------------|
      | [Yes]{: tag-green} | [Yes]{: tag-green} | [Yes]{: tag-green} |
      {: caption="Regions where activity tracking events are sent in Europe locations" caption-side="top"}
      {: #atracker-table-3}
      {: tab-title="Europe"}
      {: tab-group="atracker"}
      {: class="simple-tab-table"}
      {: row-headers}
    questions_and_answers:
      - question: Are events for the Logs Routing service available in the us-south region?
        answer: Yes, the Logs Routing service is available in the us-south region.
      - question: What regions are activity tracker events sent in Europe for Logs Routing?
        answer: Frankfurt, London, and Madrid
      - question: Are activity tracker events generated for Logs Routing?
        answer: Yes. Activity tracker events are generated for Logs Routing.
  - context: |
      # Setting up Terraform for {{site.data.keyword.logs_routing_full_notm}}
      {: #terraform-setup}

      Terraform on {{site.data.keyword.cloud}} enables predictable and consistent creation of {{site.data.keyword.cloud_notm}} services so that you can rapidly build complex, multi-tier cloud environments following Infrastructure as Code (IaC) principles. Similar to using the {{site.data.keyword.cloud_notm}} CLI or API and SDKs, you can automate the creation, update, and deletion of your {{site.data.keyword.logs_routing_full_notm}} tenants and targets by using HashiCorp Configuration Language (HCL).
      {: shortdesc}


      Looking for a managed Terraform on {{site.data.keyword.cloud}} solution? Try out [{{site.data.keyword.bplong}}](/docs/schematics?topic=schematics-getting-started). With {{site.data.keyword.bpshort}}, you can use the Terraform scripting language that you are familiar with, but you don't have to worry about setting up and maintaining the Terraform command line and the {{site.data.keyword.cloud}} Provider plug-in. {{site.data.keyword.bpshort}} also provides pre-defined Terraform templates that you can easily install from the {{site.data.keyword.cloud}} catalog.
      {: tip}

      ## Installing Terraform and configuring resources for {{site.data.keyword.logs_routing_full_notm}}
      {: #terraform-install-cli}

      Before you can create workloads with Terraform, make sure that you have completed the following prerequisites.

      - Make sure that you have set up permissions to manage tenants in the account. For more information, see [Setting up IAM permissions for managing tenants](/docs/logs-router?topic=logs-router-iam&interface=ui).
      - Install the Terraform CLI and configure the {{site.data.keyword.cloud_notm}} Provider plug-in for Terraform. For more information, see the tutorial for [Getting started with Terraform on {{site.data.keyword.cloud}}](/docs/ibm-cloud-provider-for-terraform?topic=ibm-cloud-provider-for-terraform-getting-started). The plug-in abstracts the {{site.data.keyword.cloud_notm}} APIs that are used to complete this task.
      - Create a Terraform configuration file that is named `main.tf`. In this file, you define resources by using HashiCorp Configuration Language. For more information, see the [Terraform documentation](https://developer.hashicorp.com/terraform/language){: external}.

      1. Create a {{site.data.keyword.logs_routing_full_notm}} tenant by using the `ibm_logs_router_tenant` resource argument in your `main.tf` file.

        ```terraform
        terraform {
            required_version = ">= 0.15"
            required_providers {
              ibm = {
                  source = "ibm-cloud/ibm"
                  version = ">=1.69.2"
              }
            }
        }
        provider "ibm" {
            ibmcloud_api_key = var.ibmcloud_api_key
            region = "us-south"
        }

        resource "ibm_logs_router_tenant" "logs_router_tenant_instance" {
            name = "cloud-logs-router-tenant"
            region = "eu-de"
            targets {
              log_sink_crn = "crn:v1:bluemix:public:logs:eu-de:a/1246b8fa0a174a71699f3affa2f18d78:3517d2ed-9429-af34-ad32-34248395cbc8::"
              name = "my-cloud-logs-target"
              parameters {
                  host = "3517d2ed-9429-af34-ad32-34248395cbc8.ingress.eu-de.logs.cloud.ibm.com"
                  port = 443
              }
            }
        }
        ```
        {: codeblock}


      2. After you finish building your configuration file, initialize the Terraform CLI. For more information, see [Initializing Working Directories](https://developer.hashicorp.com/terraform/cli/init){: external}.

        ```terraform
        terraform init
        ```
        {: pre}
    questions_and_answers:
      - question: How to create a Logs Routing tenant using the `ibm_logs_router_tenant` resource arguement with Terraform?
        answer: |
          To create a Logs Routing tenant with Terraform:
          ```terraform
          terraform {
              required_version = ">= 0.15"
              required_providers {
                ibm = {
                    source = "ibm-cloud/ibm"
                    version = ">=1.69.2"
                }
              }
          }
          provider "ibm" {
              ibmcloud_api_key = var.ibmcloud_api_key
              region = "us-south"
          }

          resource "ibm_logs_router_tenant" "logs_router_tenant_instance" {
              name = "cloud-logs-router-tenant"
              region = "eu-de"
              targets {
                log_sink_crn = "crn:v1:bluemix:public:logs:eu-de:a/1246b8fa0a174a71699f3affa2f18d78:3517d2ed-9429-af34-ad32-34248395cbc8::"
                name = "my-cloud-logs-target"
                parameters {
                    host = "3517d2ed-9429-af34-ad32-34248395cbc8.ingress.eu-de.logs.cloud.ibm.com"
                    port = 443
                }
              }
          }
          ```
      - question: Are there prerequisites for creating a Logs Routing tenant with Terraform?
        answer: |
          Yes. Before you can create workloads with Terraform, make sure that you have completed the following prerequisites.

          - Make sure that you have set up permissions to manage tenants in the account. For more information, see [Setting up IAM permissions for managing tenants](/docs/logs-router?topic=logs-router-iam&interface=ui).
          - Install the Terraform CLI and configure the {{site.data.keyword.cloud_notm}} Provider plug-in for Terraform. For more information, see the tutorial for [Getting started with Terraform on {{site.data.keyword.cloud}}](/docs/ibm-cloud-provider-for-terraform?topic=ibm-cloud-provider-for-terraform-getting-started). The plug-in abstracts the {{site.data.keyword.cloud_notm}} APIs that are used to complete this task.
          - Create a Terraform configuration file that is named `main.tf`. In this file, you define resources by using HashiCorp Configuration Language. For more information, see the [Terraform documentation](https://developer.hashicorp.com/terraform/language){: external}.
      - question: Why should I use Terraform for setting up Logs Routing?
        answer: Terraform on {{site.data.keyword.cloud}} enables predictable and consistent creation of {{site.data.keyword.cloud_notm}} services so that you can rapidly build complex, multi-tier cloud environments following Infrastructure as Code (IaC) principles. Similar to using the {{site.data.keyword.cloud_notm}} CLI or API and SDKs, you can automate the creation, update, and deletion of your {{site.data.keyword.logs_routing_full_notm}} tenants and targets by using HashiCorp Configuration Language (HCL).


        
